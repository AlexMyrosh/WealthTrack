<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:account="clr-namespace:WealthTrack.Client.ViewModels.Account"
             xmlns:converters="clr-namespace:WealthTrack.Client.Converters"
             x:Class="WealthTrack.Client.Views.Account.ForgotPasswordPage"
             x:DataType="account:ForgotPasswordViewModel"
             BackgroundColor="{DynamicResource ContentPageBackground}">
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:InverseBoolConverter x:Key="InverseBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>
    
    <Grid IgnoreSafeArea="True">
        <ScrollView>
            <VerticalStackLayout Padding="30" Spacing="20">
                <Label Text="Password reset" FontSize="26" FontAttributes="Bold" HorizontalOptions="Center" TextColor="{DynamicResource TitleColor}"/>
                
                <Entry Text="{Binding Email}" 
                       Placeholder="example@mail.com"
                       Keyboard="Email"
                       ClearButtonVisibility="WhileEditing"
                       BackgroundColor="{DynamicResource EntryBackground}"
                       TextColor="{DynamicResource EntryTextColor}"
                       IsEnabled="{Binding IsEmailStepEnabled}"
                />
                <Entry IsVisible="{Binding IsCodeStepVisible}" Text="{Binding Code}" 
                       Placeholder="123456"
                       MaxLength="6"
                       Keyboard="Numeric"
                       ClearButtonVisibility="WhileEditing"
                       BackgroundColor="{DynamicResource EntryBackground}"
                       TextColor="{DynamicResource EntryTextColor}"
                />
                <HorizontalStackLayout Spacing="20" HorizontalOptions="Center">
                    <Button Text="Send Code" 
                            Command="{Binding SendCodeCommand}"
                            BackgroundColor="{DynamicResource ButtonBackground}"
                            TextColor="{DynamicResource ButtonTextColor}"
                            IsVisible="{Binding IsSendCodeButtonVisible}"
                            CornerRadius="8"
                            FontSize="16"
                            FontAttributes="Bold"
                            HeightRequest="50"
                    />
                    <Button Text="{Binding ResendCodeButtonText}" 
                            Command="{Binding ResendCodeCommand}"
                            BackgroundColor="{Binding ResendButtonBackground}"
                            TextColor="{DynamicResource ButtonTextColor}"
                            IsVisible="{Binding IsResendCodeButtonVisible}"
                            IsEnabled="{Binding CanResendCode}"
                            CornerRadius="8"
                            FontSize="16"
                            FontAttributes="Bold"
                            HeightRequest="50"
                    />
                    <Button Text="Verify Code" 
                            Command="{Binding VerifyCodeCommand}"
                            BackgroundColor="{DynamicResource ButtonBackground}"
                            TextColor="{DynamicResource ButtonTextColor}"
                            IsVisible="{Binding IsCodeStepVisible}"
                            CornerRadius="8"
                            FontSize="16"
                            FontAttributes="Bold"
                            HeightRequest="50"
                    />
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </ScrollView>
        
        <Grid BackgroundColor="#80000000" IsVisible="{Binding IsBusy}" InputTransparent="{Binding IsBusy, Converter={StaticResource InverseBoolConverter}}">
            <ActivityIndicator 
                IsRunning="{Binding IsBusy}" 
                Color="White"
                WidthRequest="50"
                HeightRequest="50"
                VerticalOptions="Center"
                HorizontalOptions="Center" />
        </Grid>
    </Grid>
</ContentPage>